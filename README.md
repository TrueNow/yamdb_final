# yamdb_final
yamdb_final


# Проект доступен по адресу 
http://158.160.17.113/redoc/

## Описание проекта YaMDb
Проект YaMDb собирает отзывы пользователей на произведения. 
Произведения делятся на категории, например: «Книги», «Фильмы», «Музыка». 
Список категорий может быть расширен администратором.

Сами произведения не хранятся, посмотреть фильм или 
послушать музыку не удастся.

В каждой категории есть произведения, например: 
в категории «Книги» могут быть произведения «Винни-Пух и все-все-все» и 
«Марсианские хроники», а в категории «Музыка» — песня «Давеча» группы 
«Насекомые» и вторая сюита Баха.

Произведению может быть присвоен жанр из списка предустановленных 
(например, «Сказка», «Рок» или «Артхаус»). Новые жанры создаются только 
администратором.

Пользователи  имеют возможость оставлять к произведениям текстовые 
отзывы и ставить оценки в диапазоне от 1 до 10. Из пользовательских 
оценок формируется рейтинг произведения. 
На одно произведение пользователь может оставить только один отзыв.

### Алгоритм регистрации пользователей
1. Пользователь отправляет POST-запрос на добавление нового пользователя с 
параметрами email и username на эндпоинт /api/v1/auth/signup/.
2. YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на адрес email.
3. Пользователь отправляет POST-запрос с параметрами username и 
confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему 
приходит token (JWT-токен). В результате пользователь получает токен и может 
работать с API проекта, отправляя этот токен с каждым запросом.
4. Для повторного получения письма с кодом подтверждения пользователь отправляет
POST-запрос с параметрами username и email на эндпоинт /api/v1/auth/remind/.
5. При желании пользователь отправляет PATCH-запрос на эндпоинт 
/api/v1/users/me/ и заполняет поля в своём профайле.
6. Если пользователя создаёт администратор, например, через POST-запрос на 
эндпоинт api/v1/users/ — письмо с кодом также приходит к нему на почту.

## Запуск с использованием CI/CD

Установить docker, docker-compose на боевом сервере
```
ssh <username>@<server_ip>
sudo apt install docker.io
https://docs.docker.com/compose/install/ # docker-compose
```
- Заполнить в настройках репозитория секреты согласно env_template.txt
- В docker-compose web:image установить свой контейнер

Скопировать на сервер настройки docker-compose и nginx/
```
scp docker-compose.yaml <username>@<server_ip>:/home/<username>/
scp -r nginx/ <username>@<server_ip>:/home/<username>/nginx/
```

## Запуск проекта через Docker

Собрать контейнер:
- docker-compose up -d

Прижелании выполнить следующие команды:
```
docker-compose exec web python manage.py createsuperuser  # Создание суперпользователя
docker-compose exec web python manage.py loaddata fixtures.json  # Загрузка БД из дампа 
```

## Запуск проекта в dev-режиме

- Установить и активировать виртуальное окружение
- Установить зависимости из файла requirements.txt
```
python -m pip install --upgrade pip
pip install -r requirements.txt
```
- Выполнить миграции:
```
python manage.py migrate
```

- В папке с файлом manage.py выполнить команду:
```
python manage.py runserver
```
- Сервер будет доступен по ссылке:
http://127.0.0.1/redoc/

![example workflow](https://github.com/github/docs/actions/workflows/main.yml/badge.svg)